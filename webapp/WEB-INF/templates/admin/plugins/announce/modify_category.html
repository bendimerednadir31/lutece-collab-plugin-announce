<#include "comboorders_macro.html" />
<@box>
	<@boxHeader title='#i18n{announce.modify_category.pageTitle}' />
	<@boxBody params='style="display: flex;"'>
		<@div params='style="flex: 1  0 50%; margin-right: 100px;"'>
		<@tform class='create_sector' method='post' action='jsp/admin/plugins/announce/DoModifyCategory.jsp'>
		<@input type="hidden" name="category_id" value="${category.id}" />
			<@formGroup labelKey='#i18n{announce.category.label}' helpKey='#i18n{announce.category.label}' mandatory=true >
			  	<@input name='category_label' type='text'  value=category.label maxlength=50  />
			</@formGroup>
			<@formGroup labelKey='#i18n{announce.category.sector}' mandatory=true >
				<@select name='category_sector_id' items=list_sectors default_value=category.idSector?string />
			</@formGroup>
			<@formGroup labelKey='#i18n{announce.category.announcesValidation}' mandatory=true >
				<@select name='category_announces_validation' items=list_announces_validation default_value=category.announcesValidation?string />
			</@formGroup>
			<@formGroup labelKey='#i18n{announce.category.mailingList}' helpKey='#i18n{announce.category.mailingList.helper}'>
				<@select name='mailing_list_id' items=mailing_list_list default_value=category.idMailingList?string />
			</@formGroup>
			<@formGroup  helpKey='#i18n{announce.category.displayPrice.helper}' >
				<@checkBox name='display_price' value="true"  checked=category.displayPrice labelKey='#i18n{announce.category.displayPrice}' />
			</@formGroup>
			<@formGroup  helpKey='#i18n{announce.category.priceMandatory.helper}' >
				<@checkBox name='price_mandatory' value="true"  checked=category.priceMandatory labelKey='#i18n{announce.category.priceMandatory}' />
			</@formGroup>		
			<#if isCaptchaEnabled?? && isCaptchaEnabled>
				<@formGroup >
					<@checkBox name='display_captcha' value="true"  checked=category.displayCaptcha labelKey='#i18n{announce.category.displayCaptcha}' />
				</@formGroup>		
			</#if>	
			<#if listWorkflows??>
				<@formGroup labelKey='#i18n{announce.create_category.labelWorkflow}' >
					<@select name='id_workflow' items=listWorkflows default_value=category.idWorkflow?string />
				</@formGroup>		
			</#if>
			<@actionButtons button1Name="action_createSector" url2='jsp/admin/plugins/announce/ManageCategories.jsp'/> 
		</@tform>
		</@div>
		<@div params='style="flex: 2  0 50%;"'>		
			<@div class="col-xs-12 col-sm-12 col-md-8" >
				<@div class="box box-primary">
					<@div class="box-header">
						<h3 class="box-title">#i18n{announce.modify_category.defaultEntries}</h3>
					</@div>
						<@div class="box-body table-responsive">
							<@table class="table table-hover">
								<@tr>
									<@th>#i18n{announce.modify_category.entry_list.labelTitle}</@th>
									<@th>#i18n{announce.modify_category.entry_list.labelType}</@th>
								</@tr>
								<@tr>
									<@td>#i18n{announce.modify_category.defaultEntries.entryTitle}</@td>
									<@td>#i18n{announce.entryType.text.title}</@td>
								</@tr>
								<@tr>
									<@td>#i18n{announce.modify_category.defaultEntries.entryDescription}</@td>
									<@td>#i18n{announce.entryType.textArea.title}</@td>
								</@tr>
							</@table>
						</@div>
					</@div>
					<@div class="box box-primary">
						<@div class="box-header">
							<h3 class="box-title">#i18n{announce.modify_category.entry_list.adminTitle}</h3>
							<@div class="box-tools">
								<#if entry_type_list?has_content>
									<@tform method="post" class="form-inline pull-right" action="jsp/admin/plugins/announce/ManageCategoryEntries.jsp">
										<@input type="hidden" value="getCreateEntry" name="view" />
										<@input type="hidden" name="id_category" value="${category.id}" />
										<@formGroup labelFor='#i18n{announce.modify_category.create_entry.labelEntryType}' />
										<@div class="input-group">
											<@select name="id_type" items=entry_type_list default_value="-1" params="class=\"form-control input-xs\"" />
											<@span params='title="#i18n{announce.modify_category.create_entry.buttonLabelCreate}"'>
												<@button type='submit' name='view_createSector' buttonIcon='plus'  />
											</@span>
										</@div>
									</@tform>
								</#if>
								<@tform method="post"	action="jsp/admin/plugins/announce/ManageCategoryEntries.jsp" class="form-inline pull-right spaced">
									<@input type="hidden" name="action" value="doChangeOrderEntry" />
									<@input type="hidden" name="id_category" value="${category.id}" />
									<#if entry_group_list?has_content>
										<!-- List all entry of type group  -->
										<@div class="input-group">
											<@select name="id_entry_group" items=entry_group_list default_value="" params="class=\"form-control input-xs\"" />
											<@span params='title="#i18n{announce.modifyField.manageConditionalQuestion.titleMove}"'>
												<@button type='submit' buttonIcon='arrow-right' name="add_to_group" value="move"/>
											</@span>
										</@div>
									</#if>
								</@tform>
							</@div>
						</@div>
						<@div class="box-body table-responsive">
							<@table class="table table-hover">
								<@tableHead>
									<@tr>
										<@th>
											<input type="checkbox" name="selectAll" id="selectAll" value="selectAll" title="#i18n{announce.modify_category.selectAll}" />
										</@th>
										<@th>
											#i18n{announce.createEntry.manageField.rowTitle}
										</@th>
										<@th>
											#i18n{announce.modifyField.manageConditionalQuestion.rowType}
										</@th>
										<@th>
											<@icon class="icon-question-sign" title="#i18n{announce.createEntry.manageField.rowConditionalQuestion}" />
										</@th>
										<@th>
											#i18n{announce.createEntry.manageField.rowOrder}
										</@th>
										<@th>
											#i18n{announce.createEntry.manageField.rowActions}&nbsp;
										</@th>
									</@tr>
								</@tableHead>
								<@tableBody>
									<#list entry_list as entry>
										<#if entry.entryType.group>
											<#assign lastGroup = entry>
										</#if>
										<@tr>
											<@td>
												<!--  add checkbox if entry isn't a group --> 
												<#if !entry.entryType.group>
													<input type="checkbox" name="entry_id_move" value="${entry.idEntry!}">
												</#if>
											</@td>
											<@td>
												<#if entry.entryType.group>
													${entry.title}
												<#elseif entry.parent?exists>
													<#if entry.entryType.comment>
														<@icon class="fa fa-caret-right" />${entry.comment}
													<#else>
														<@icon class="fa fa-caret-right" />${entry.title}
													</#if>
												<#elseif entry.entryType.myLuteceUser>
														${entry.title}
												<#else>
													<#if entry.entryType.comment>
														${entry.comment}
													<#else>
														${entry.title}
													</#if>
												</#if>
											</@td>	
											<@td>	
												<#if !entry.entryType.group>
													<span class="badge">${entry.entryType.title}</span>
												</#if>
											</@td>
											<@td>
												<#if entry.numberConditionalQuestion!=0>
													${entry.numberConditionalQuestion}
												</#if>
											</@td>
											<!--  Change the order of the attribute -->
											<#if entry.parent?exists>
												<@td>
													<@div class="col-md-6">
														<@div class="input-group">
														<@comboOrders name="order_id_${entry.idEntry}" default_value=entry.position idParent=entry.parent.idEntry />
															<@span params='title="#i18n{announce.modifyField.manageConditionalQuestion.titleMove}"'>
																<@button type='submit' name="id_entry" title="" value="${entry.idEntry}" >
																	<@icon style='check' class="fa fa-check" />
																</@button>
															</@span>															
														</@div>
													</@div>
												</@td>
											<#else>
												<@td>
													<@div class="col-md-6">
														<@div class="input-group">
														<@comboOrders name="order_id_${entry.idEntry}" default_value=entry.position idParent=0 />
															<@span params='title="#i18n{announce.modifyField.manageConditionalQuestion.titleMove}"'>
																<@button type='submit' name="id_entry" title="" value="${entry.idEntry}" >
																	<@icon style='check' class="fa fa-check" />
																</@button>
															</@span>
														</@div>
													</@div>
												</@td>
											</#if>
											<@td>
												<#if !entry.entryType.myLuteceUser>
													<@aButton href='jsp/admin/plugins/announce/ManageCategoryEntries.jsp?view=getModifyEntry&id_entry=${entry.idEntry}' title='#i18n{portal.util.labelModify}' hideTitle=['all'] buttonIcon='pencil' />
												</#if>
												<#if entry.parent?exists>
													<@aButton href='jsp/admin/plugins/announce/ManageCategoryEntries.jsp?action=doMoveOutEntry&id_entry=${entry.idEntry}#list' title='#i18n{announce.modifyField.manageConditionalQuestion.titleGoOut}' hideTitle=['all'] >
														<@icon class="fa fa-sign-out" />
													</@aButton>
												</#if>
												<#if !entry.entryType.group && !entry.entryType.myLuteceUser>
													<@aButton href='jsp/admin/plugins/announce/ManageCategoryEntries.jsp?action=doCopyEntry&id_entry=${entry.idEntry}#list' title='#i18n{announce.createEntry.manageField.titleCopy}' hideTitle=['all'] buttonIcon='copy' />
												</#if>
												<@aButton href='jsp/admin/plugins/announce/ManageCategoryEntries.jsp?view=confirmRemoveEntry&id_entry=${entry.idEntry}#list' title='#i18n{announce.modifyField.manageConditionalQuestion.titleDelete}' buttonIcon='trash' hideTitle=['all'] color='danger' />								
											</@td>
										</@tr>
									</#list>
								</@tableBody>
							</@table>
						</@div>
					</@div>
				</@div>
		</@div>

  </@boxBody>
</@box>
<script>
$(document).ready(function() {
	$("#selectAll").click( function(){
		if( this.checked ){
			$('.table input[type="checkbox"]').each( function() {this.checked = true;} );
		} else {
			$('.table input[type="checkbox"]').each(function() { this.checked = false; } );
		}
	});
});
</script>